---
title: "Practice 1"
author: "Ignacio Almodóvar Cárdenas & Luis Angel Rodriguez Garcia"
date: "2/22/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
library(magrittr)
```

# Introduction

```{r}
library(datasets)
data=warpbreaks
```

We want to provide a conditional estimation on the number of breaks for different types of threads. Therefore, as the data provided contains observations from different groups of threads, we are going to split them into six different groups. This way we can apply Bayesian Inference to obtain insights for each type of group.

The dataset contains 3 variables, 

- Nb of breaks (continuous variable)
- Wool, which is categorical variable with levels A and B.
- Tension. Another categorical variable that indicates the tension of the thread (L,M and H)

As we just mentioned, we are going to split the data into 6 different groups. Therefore we will have one group for wool A with Low tension, another for wool A with Medium tension, wool A with high tension...

Once we have our groups well defined, we can start to apply Bayesian Inference. As we want to have more knowledge about the mean number of breaks during weaving for different configurations, we can model our problem as a Poisson distribution, being the count the number of breaks. Therefore, 

$$Y_{1,1}...Y_{n,1} | \theta_1 \sim i.id. Poisson(\theta_{1})$$
$$Y_{1,2}...Y_{n,2} | \theta_2 \sim i.id. Poisson(\theta_{2})$$
$$.$$
$$.$$
$$.$$

$$Y_{1,6}...Y_{n,6} | \theta_6 \sim i.id. Poisson(\theta_{6})$$

We also know that for a poisson distribution, both mean and variances are:

$$E[Y|\theta]=\theta$$
$$Var[Y|\theta]=\theta$$
However, we do not have any information about $\theta$, therefore we have to estimate it. The only knowledge we have about it is that from the prior we can assume that that:

$$\theta \sim gamma(a,b)$$
Therefore, we have to assign values for both "a" and "b". For a Gamma distribution we know that:

$$E[\theta]=\frac{a}{b}$$

From the prior we have to guess the mean number of breaks. As we do not have explicit information from \theta we have to set it in a rough way. For that we are going to use 

....

Now, setting b as ... we get that a is ... and we have our prior set.


To obtain the posterior, knowing the conjugate prior of the gamma, we obtain the posterior as: 


$$\{\theta|Y_1,...,Y_n\}\sim gamma(a+\sum_{i=1}^{n}Y_i,b+n)$$


## Plots

```{r}
ggplot(data,aes(x=breaks, fill= wool,alpha=0.5)) + geom_density() + facet_wrap(~tension)
```


# Empirical distributions

```{r,echo=FALSE}
g1 = data %>% dplyr::filter(wool=="A" & tension=="L")
g2 = data %>% dplyr::filter(wool=="A" & tension=="M")
g3 = data %>% dplyr::filter(wool=="A" & tension=="H")
g4 = data %>% dplyr::filter(wool=="B" & tension=="L")
g5 = data %>% dplyr::filter(wool=="B" & tension=="M")
g6 = data %>% dplyr::filter(wool=="B" & tension=="H")
```



$$Y_{1,1}...Y_{n,1} | \theta \sim i.id. Poisson(\theta_{1})$$
$$Y_{1,2}...Y_{n,2} | \theta \sim i.id. Poisson(\theta_{2})$$
$$\vdots$$

$$Y_{1,6}...Y_{n,6} | \theta \sim i.id. Poisson(\theta_{6})$$


```{r}
n1=nrow(g1)
sy1=sum(g1$breaks)
mu1=mean(g1$breaks)

n2=nrow(g2)
sy2=sum(g2$breaks)
mu2=mean(g2$breaks)

n3=nrow(g3)
sy3=sum(g3$breaks)
mu3=mean(g3$breaks)
  
n4=nrow(g4)
sy4=sum(g4$breaks)
mu4=mean(g4$breaks)

n5=nrow(g5)
sy5=sum(g5$breaks)
mu5=mean(g5$breaks)

n6=nrow(g6)
sy6=sum(g6$breaks)
mu6=mean(g6$breaks)
```


Without any information of the sample we can assume that the mean number of breaks is 25. Therefore we can assume that our $\theta$ is distributed as $\theta \sim gamma(5,5.2)$


```{r}
a=5
b=5.2

posterior_mean=function(sy,n){
  return((a+sy)/(b+n))
}


posterior_mode=function(sy,n){
  return((a+sy-1)/(b+n))
}

#posterior mean for group A-L
posterior_mean(sy1,n1)

#posterior mode for group A-M
posterior_mode(sy2,n2)


#CI 95% for group A-M
qgamma(c(0.025,0.975),a+sy1,b+n2)
```





```{r}
modea <- function(x) {
   return(as.numeric(names(which.max(table(x)))))
}

a1=modea(g1$breaks)
a2=modea(g2$breaks)
a3=modea(g3$breaks)
a4=modea(g4$breaks)
a5=modea(g5$breaks)
a6=modea(g6$breaks)

vector=c(a1,a2,a3,a4,a5,a6)
mean(vector)

```
 We can assume a=23,b=1







